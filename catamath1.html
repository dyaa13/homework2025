<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Quiz with Answers Array</title>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        .quiz-container {
            max-width: 900px;
            margin: 40px auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
        }

        #headerLogo {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background-color: #0d47a1;
            border-radius: 4px;
        }

        .logo-text span.edu {
            font-size: 0.9em;
            color: #ff9800;
            font-weight: 700;
            margin-left: 10px;
        }

        .quiz-main {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .sidebar {
            width: 120px;
            border-right: 1px solid #ddd;
            padding-right: 10px;
            display: none;
        }

        .sidebar h4 {
            margin: 0 0 8px;
            font-size: 0.95em;
            border-bottom: 1px solid #eee;
            padding-bottom: 4px;
        }

        .sidebar ul { list-style: none; padding: 0; margin: 0; }
        .sidebar li {
            padding: 6px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .sidebar li.active {
            background: #bbdefb;
            font-weight: 600;
        }
        .sidebar li.answered {
            border-left: 4px solid #4caf50;
        }

        #quizContent { flex: 1; }

        .question-text {
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .answer-box {
            width: 200px;
            padding: 10px;
            font-size: 1.05em;
        }

        .button-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        button {
            padding: 10px 20px;
            border: none;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
        }

        #nextButton { background:#4caf50; }
        #backButton { background:#039be5; }

        table.review-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .review-table th,
        .review-table td {
            border: 1px solid #ccc;
            padding: 8px;
            font-size: 0.9em;
        }

        .review-table th {
            background: #f2f2f2;
        }

        .correct-answer { background: #d4edda; }
        .incorrect-answer { background: #f8d7da; }

        @media (max-width: 700px) {
            .quiz-main {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #ddd;
                margin-bottom: 10px;
                padding-bottom: 10px;
            }
        }
    </style>
</head>

<body>

<div class="quiz-container">
    <!-- Logo -->
    <div id="headerLogo">
        <div class="logo-icon"></div>
        <div class="logo-text"><span class="edu">EDUCATION</span></div>
    </div>

    <h2>Image Quiz</h2>

    <div class="quiz-main">
        <div id="sidebar" class="sidebar"></div>
        <div id="quizContent"></div>
    </div>

    <div class="button-container">
        <button id="backButton" style="display:none;">Previous</button>
        <button id="nextButton" style="display:none;">Next</button>
    </div>
</div>

<script>
/* ----------------------------------------------------------
   CONFIG: 题目文件夹 / 题目数量 / 每题答案
---------------------------------------------------------- */

// 图片文件夹名称（相对当前 HTML 所在路径）
const QUESTION_FOLDER = "cantmath1";

// 题目数量（自动按 q1.png ~ qN.png 读取）
const NUM_QUESTIONS = 20;

// 每道题的正确答案（index 0 对应 q1.png，index 1 对应 q2.png ...）
const ANSWERS = [42,183.2,59,22,3600,79,11/20,122,34731,3,125,50,540,14,1/2,10.5,1800,57.7,109,27];
// ⚠️ 请确保 ANSWERS.length >= NUM_QUESTIONS


/* ----------------------------------------------------------
   全局变量
---------------------------------------------------------- */
let questions = [];        // { text: html-string, answer: number }
let userAnswers = [];      // { value: string, isCorrect: bool }
let currentQuestionIndex = 0;
let studentName = "";
let quizStartTime = null;
let quizEndTime = null;

// DOM 元素引用
const quizContent = document.getElementById("quizContent");
const sidebarEl   = document.getElementById("sidebar");
const backButton  = document.getElementById("backButton");
const nextButton  = document.getElementById("nextButton");


/* ----------------------------------------------------------
   构建题目：使用 QUESTION_FOLDER + ANSWERS
---------------------------------------------------------- */
function generateQuestions() {
    questions = [];

    for (let i = 1; i <= NUM_QUESTIONS; i++) {
        const ans = ANSWERS[i - 1];

        if (typeof ans === "undefined") {
            console.warn(`WARNING: ANSWERS[${i - 1}] is undefined. Please add more answers.`);
        }

        questions.push({
            text: `<img src="${QUESTION_FOLDER}/q${i}.png" style="max-width:100%;">`,
            answer: ans
        });
    }

    userAnswers = Array(NUM_QUESTIONS)
        .fill(null)
        .map(() => ({ value: "", isCorrect: false }));
}


/* ----------------------------------------------------------
   解析学生输入：支持整数 / 小数 / 分数 a/b
---------------------------------------------------------- */
function parseAnswer(str) {
    const s = str.trim();
    if (s === "") return NaN;

    // 分数形式 a/b
    if (s.includes("/")) {
        const parts = s.split("/");
        if (parts.length !== 2) return NaN;

        const num = Number(parts[0]);
        const den = Number(parts[1]);
        if (!Number.isFinite(num) || !Number.isFinite(den) || den === 0) return NaN;

        return num / den;
    }

    // 普通数字
    const n = Number(s);
    return Number.isFinite(n) ? n : NaN;
}


/* ----------------------------------------------------------
   Sidebar 渲染 & 更新
---------------------------------------------------------- */
function renderSidebar() {
    sidebarEl.style.display = "block";

    sidebarEl.innerHTML = `
        <h4>Questions</h4>
        <ul id="qList"></ul>
    `;

    const qList = document.getElementById("qList");

    for (let i = 0; i < NUM_QUESTIONS; i++) {
        const li = document.createElement("li");
        li.textContent = `Q${i + 1}`;
        li.dataset.index = i;

        li.addEventListener("click", () => {
            saveCurrentInput();
            currentQuestionIndex = i;
            renderQuestion();
        });

        qList.appendChild(li);
    }

    updateSidebarStatus();
}

function updateSidebarStatus() {
    const items = document.querySelectorAll("#qList li");

    items.forEach(li => {
        const idx = Number(li.dataset.index);
        li.classList.toggle("active", idx === currentQuestionIndex);
        li.classList.toggle("answered", userAnswers[idx].value.trim() !== "");
    });
}


/* ----------------------------------------------------------
   显示当前题目
---------------------------------------------------------- */
function renderQuestion() {
    const q = questions[currentQuestionIndex];

    quizContent.innerHTML = `
        <p class="question-text">
            Question ${currentQuestionIndex + 1} of ${NUM_QUESTIONS}
        </p>
        ${q.text}
        <br><br>
        <input
            id="answerInput"
            class="answer-box"
            type="text"
            value="${userAnswers[currentQuestionIndex].value}"
        >
    `;

    backButton.style.display = "inline-block";
    nextButton.style.display = "inline-block";

    if (currentQuestionIndex === 0) {
        backButton.style.visibility = "hidden";
    } else {
        backButton.style.visibility = "visible";
    }

    if (currentQuestionIndex === NUM_QUESTIONS - 1) {
        nextButton.textContent = "Submit & View Results";
    } else {
        nextButton.textContent = "Next";
    }

    updateSidebarStatus();
}

function saveCurrentInput() {
    const input = document.getElementById("answerInput");
    if (input) {
        userAnswers[currentQuestionIndex].value = input.value;
    }
}


/* ----------------------------------------------------------
   计算成绩并显示结果页面
---------------------------------------------------------- */
function calculateAndShowResults() {
    quizEndTime = new Date();

    let score = 0;

    questions.forEach((q, idx) => {
        const raw = userAnswers[idx].value.trim();
        const val = parseAnswer(raw);

        let correct = false;
        if (Number.isFinite(val) && Number.isFinite(q.answer)) {
            correct = (val === q.answer);
        }

        userAnswers[idx].isCorrect = correct;
        if (correct) score++;
    });

    // 计算用时
    let timeInfoHtml = "";
    if (quizStartTime && quizEndTime) {
        const diffMs = quizEndTime - quizStartTime;
        const totalSec = Math.floor(diffMs / 1000);
        const minutes = Math.floor(totalSec / 60);
        const seconds = totalSec % 60;

        const startStr = quizStartTime.toLocaleTimeString();
        const endStr   = quizEndTime.toLocaleTimeString();

        timeInfoHtml = `
            <p>Start time: <strong>${startStr}</strong></p>
            <p>Submit time: <strong>${endStr}</strong></p>
            <p>Time taken: <strong>${minutes} minute${minutes !== 1 ? "s" : ""} ${seconds} second${seconds !== 1 ? "s" : ""}</strong></p>
        `;
    }

    let html = `
        <h3>Results for ${studentName}</h3>
        <p>Score: ${score} / ${NUM_QUESTIONS}</p>
        ${timeInfoHtml}
        <table class="review-table">
            <tr>
                <th>#</th>
                <th>Your Answer</th>
                <th>Correct Answer</th>
                <th>Result</th>
            </tr>
    `;

    for (let i = 0; i < NUM_QUESTIONS; i++) {
        html += `
            <tr>
                <td>Q${i + 1}</td>
                <td>${userAnswers[i].value || "—"}</td>
                <td>${questions[i].answer}</td>
                <td class="${userAnswers[i].isCorrect ? "correct-answer" : "incorrect-answer"}">
                    ${userAnswers[i].isCorrect ? "Correct" : "Incorrect"}
                </td>
            </tr>
        `;
    }

    html += `</table>`;

    quizContent.innerHTML = html;

    // 保留左侧 sidebar（仍可点回各题），隐藏上下按钮
    backButton.style.display = "none";
    nextButton.style.display = "none";
}


/* ----------------------------------------------------------
   上一题 / 下一题 按钮
---------------------------------------------------------- */
nextButton.addEventListener("click", () => {
    saveCurrentInput();

    if (currentQuestionIndex === NUM_QUESTIONS - 1) {
        calculateAndShowResults();
    } else {
        currentQuestionIndex++;
        renderQuestion();
    }
});

backButton.addEventListener("click", () => {
    saveCurrentInput();
    if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        renderQuestion();
    }
});


/* ----------------------------------------------------------
   起始页面：输入名字
---------------------------------------------------------- */
function showStartScreen() {
    sidebarEl.style.display = "none";
    nextButton.style.display = "none";
    backButton.style.display = "none";

    quizContent.innerHTML = `
        <p>This quiz contains ${NUM_QUESTIONS} questions.</p>
        <p>Please enter your name:</p>
        <input
            id="nameInput"
            type="text"
            style="padding:10px; width:250px; font-size:1.05em;"
            placeholder="Your name"
        >
        <button id="startButton" style="margin-left:10px; background:#4caf50;">
            Start
        </button>
    `;

    document.getElementById("startButton")
        .addEventListener("click", startQuiz);
}

function startQuiz() {
    const nameInput = document.getElementById("nameInput");
    studentName = (nameInput.value || "Student").trim();

    quizStartTime = new Date();
    generateQuestions();
    renderSidebar();
    renderQuestion();
}


/* ----------------------------------------------------------
   初始化
---------------------------------------------------------- */
showStartScreen();

</script>

</body>
</html>
