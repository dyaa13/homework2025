<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Random Mixed Calculation Quiz</title>

<style>
body{
  font-family:'Segoe UI',Tahoma,sans-serif;
  background:#f4f4f9;
  margin:0;
  padding:20px;
  color:#333;
}
.quiz-container{
  max-width:900px;
  margin:40px auto;
  background:#fff;
  padding:30px;
  border-radius:12px;
  box-shadow:0 6px 15px rgba(0,0,0,0.1);
}
#headerLogo{
  display:flex;
  align-items:center;
  border-bottom:2px solid #e0e0e0;
  padding-bottom:10px;
  margin-bottom:10px;
}
.logo-icon{
  width:40px;height:40px;
  background:#0d47a1;
  border-radius:4px;
}
.logo-text span{
  margin-left:10px;
  color:#ff9800;
  font-weight:700;
}
.top-bar{
  display:flex;
  justify-content:space-between;
  flex-wrap:wrap;
  margin-bottom:10px;
}
#timerDisplay,#studentDisplay{
  font-size:0.95em;
  font-weight:600;
}
.quiz-main{
  display:flex;
  gap:20px;
}
.sidebar{
  width:140px;
  border-right:1px solid #ddd;
  padding-right:10px;
}
.sidebar ul{
  list-style:none;
  padding:0;margin:0;
}
.sidebar li{
  padding:6px;
  cursor:pointer;
  border-radius:4px;
}
.sidebar li.active{outline:2px solid #1976d2;}
.sidebar li.correct{background:#d4edda;}
.sidebar li.incorrect{background:#f8d7da;}
#quizContent{flex:1;}
.answer-box{width:140px;font-size:1em;padding:6px;margin-left:8px;}
button{
  padding:10px 20px;
  border:none;
  border-radius:6px;
  color:white;
  cursor:pointer;
}
#nextButton{background:#4caf50;}
#backButton{background:#039be5;}
#submitButton{background:#9c27b0;}
#generateButton{background:#ff9800;}
#pauseButton{background:#f57c00;}

.frac{display:inline-block;text-align:center;}
.frac .top{display:block;border-bottom:1px solid #000;}
.frac .bottom{display:block;font-size:0.9em;}
</style>
</head>

<body>
<div class="quiz-container">
  <div id="headerLogo">
    <div class="logo-icon"></div>
    <div class="logo-text"><span>EDUCATION</span></div>
  </div>

  <div class="top-bar">
    <div>
      <span id="timerDisplay">Time: 00:00</span>
      &nbsp;&nbsp;
      <span id="studentDisplay"></span>
    </div>
    <div>
      <button id="pauseButton">Pause</button>
      <button id="generateButton">Generate New Set</button>
    </div>
  </div>

  <div class="quiz-main">
    <div id="sidebar" class="sidebar"></div>
    <div id="quizContent"></div>
  </div>

  <div style="margin-top:20px;">
    <button id="backButton">Previous</button>
    <button id="nextButton">Next</button>
    <button id="submitButton">Submit</button>
  </div>
</div>

<script>
/* =========================================================
   工具 & 基础
========================================================= */
const PARTS=[
  "A. Mixed Decimals / Integers / Negatives",
  "B. Fractions × ÷",
  "C. Mixed Decimals / Fractions / Percentages"
];
const PER_PART=6;
const TOTAL=18;

const rand=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const choice=a=>a[rand(0,a.length-1)];
const gcd=(a,b)=>b?gcd(b,a%b):Math.abs(a);
const fracHTML=f=>f.d===1?f.n:`<span class="frac"><span class="top">${f.n}</span><span class="bottom">${f.d}</span></span>`;
const simplify=f=>{const g=gcd(f.n,f.d);return{n:f.n/g,d:f.d/g};};
const sig=t=>t.replace(/<[^>]+>/g,"").replace(/\s+/g," ").toLowerCase();

/* =========================================================
   题目生成（难度逐渐增加）
========================================================= */

function genDecimal(level){
  let a=rand(10,level<=3?99:199);
  let b=rand(2,level<=3?9:12);
  let sa=level>=2?rand(0,2):0;
  let sb=level>=3?rand(0,2):0;
  if(Math.random()<level*0.1)a=-a;
  if(Math.random()<level*0.1)b=-b;
  const A=a/10**sa,B=b/10**sb;
  return{
    text:`${A} × ${B}`,
    value:A*B
  };
}

function genFraction(level){
  const d=choice(level<=3?[2,3,4,5,6]:[3,4,5,6,8,10,12]);
  let n=rand(1,level<=3?d-1:d*2);
  if(Math.random()<level*0.1)n=-n;
  const f1=simplify({n,d});
  const f2=simplify({n:rand(1,d-1),d});
  const r=simplify({n:f1.n*f2.n,d:f1.d*f2.d});
  return{
    text:`${fracHTML(f1)} × ${fracHTML(f2)}`,
    value:r.n/r.d,
    display:fracHTML(r)
  };
}

function genMixed(level){
  const dec=choice(level<=3?[0.5,0.75,1.2]:[0.36,0.48,0.6,1.5,2.4]);
  const p=choice(level<=3?[25,50]:[12.5,20,25,40,75]);
  const v=dec*(p/100);
  return{text:`${p}% of ${dec}`,value:v};
}

/* =========================================================
   生成整套（去重 + 难度递增）
========================================================= */
let questions=[];
function generateQuiz(){
  questions=[];
  const used=new Set();
  for(let p=0;p<3;p++){
    for(let i=1;i<=6;i++){
      let q,attempt=0;
      do{
        q=p===0?genDecimal(i):p===1?genFraction(i):genMixed(i);
        attempt++;
      }while(used.has(sig(q.text))&&attempt<100);
      used.add(sig(q.text));
      questions.push({...q,part:p,idx:i-1,user:"",correct:false});
    }
  }
}

/* =========================================================
   UI & Logic
========================================================= */
let cur=0,startTime=Date.now(),paused=false,elapsed=0;
const qc=document.getElementById("quizContent");
const sb=document.getElementById("sidebar");
const timer=document.getElementById("timerDisplay");

function renderSidebar(){
  sb.innerHTML="<ul>"+questions.map((q,i)=>
    `<li onclick="go(${i})">${i+1}</li>`).join("")+"</ul>";
}
function render(){
  const q=questions[cur];
  qc.innerHTML=`
    <h3>${PARTS[q.part]}</h3>
    <p>Q${cur+1}: ${q.text}
    <input class="answer-box" value="${q.user}" oninput="save(this.value)">
    </p>`;
}
function save(v){questions[cur].user=v;}
function go(i){cur=i;render();}
function tick(){
  if(!paused){
    const t=elapsed+(Date.now()-startTime);
    timer.textContent="Time: "+Math.floor(t/1000)+"s";
  }
}
setInterval(tick,1000);

/* =========================================================
   Init
========================================================= */
const params=new URLSearchParams(location.search);
document.getElementById("studentDisplay").textContent=
  "Student: "+(params.get("name")||"Student");

generateQuiz();
renderSidebar();
render();
</script>
</body>
</html>
