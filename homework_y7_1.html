<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICAS Year 7 – 2019</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .quiz-container {
            max-width: 950px;
            margin: 40px auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        /* 左右布局：左侧题号导航 + 右侧内容 */
        .quiz-main {
            display: flex;
            align-items: flex-start;
        }

        .question-nav {
            min-width: 120px;
            margin-right: 20px;
            font-size: 0.9em;
        }
        .question-nav table {
            width: 100%;
            border-collapse: collapse;
        }
        .question-nav td {
            border: 1px solid #ddd;
            padding: 6px 4px;
            text-align: center;
            cursor: pointer;
            user-select: none;
        }
        .question-nav td:hover {
            background-color: #e3f2fd;
        }
        .question-nav td.current-question {
            background-color: #bbdefb;
            font-weight: bold;
        }

        .quiz-main-right {
            flex: 1;
        }

        #headerLogo {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        .logo-text {
            line-height: 1.2;
            margin-left: 10px;
        }
        .logo-text span.edu {
            font-size: 0.8em;
            letter-spacing: 1px;
            font-weight: 600;
            color: #ff9800; /* Orange */
            display: block;
        }
        .logo-icon {
            width: 40px;
            height: 40px;
            background-color: #0d47a1;
            border-radius: 4px;
            position: relative;
        }
        .logo-icon::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 5px;
            width: 30px;
            height: 10px;
            background-color: #ff9800;
            border-radius: 2px;
        }

        .button-container {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }

        #nextButton, #backButton, #startButton, #saveResultsButton {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }
        #backButton {
            background-color: #03A9F4;
        }
        #saveResultsButton {
            margin-top: 20px;
            background-color: #ff9800;
        }
        #nextButton:hover, #startButton:hover { background-color: #388E3C; }
        #backButton:hover { background-color: #0288D1; }
        #saveResultsButton:hover { background-color: #fb8c00; }

        .question-text {
            font-size: 1.1em;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        .options-list {
            list-style: none;
            padding: 0;
            cursor: pointer;
        }
        .options-list li {
            margin-bottom: 15px;
            border: 1px solid #ddd;
            padding: 12px;
            border-radius: 8px;
            transition: all 0.2s;
            cursor: pointer;
        }
        .options-list li:hover {
            background-color: #e3f2fd;
            border-color: #03A9F4;
        }
        .options-list li.selected {
            background-color: #bbdefb;
            border-color: #0288D1;
            font-weight: bold;
        }

        .review-table { width: 100%; border-collapse: collapse; margin-top: 20px; text-align: left; font-size: 0.9em; }
        .review-table th, .review-table td { border: 1px solid #ddd; padding: 10px; }
        .review-table th { background-color: #f2f2f2; color: #333; }
        .correct-answer { background-color: #d4edda; color: #155724; font-weight: bold; }
        .incorrect-answer { background-color: #f8d7da; color: #721c24; font-weight: bold; }
        #startScreen input { padding: 10px; width: 80%; margin-right: 10px; border: 1px solid #ccc; border-radius: 4px; }
        #studentInfo { font-size: 1.1em; margin-bottom: 15px; border-bottom: 1px dashed #ccc; padding-bottom: 10px; }
    </style>
</head>
<body>

<div class="quiz-container">
    <div class="quiz-main">
        <div id="questionNav" class="question-nav"></div>

        <div class="quiz-main-right">
            <div id="headerLogo">
                <div class="logo-icon"></div>
                <div class="logo-text">
                    <span class="edu">EDUCATION</span>
                </div>
            </div>

            <h2 id="quizTitle">ICAS Year 7 – 2019</h2>

            <div id="quizContent"></div>

            <div class="button-container">
                <button id="backButton" style="display:none;">Previous</button>
                <button id="nextButton" style="display:none;">Next Question</button>
            </div>
        </div>
    </div>
</div>

<script>
  // ======= NEW: get student name from URL (?name=Dorathy) =======
  function getStudentNameFromURL() {
      const params = new URLSearchParams(window.location.search);
      const n = (params.get("name") || "").trim();
      return n;
  }
  const urlStudentName = getStudentNameFromURL();
  // =============================================================

  const IMG_FOLDER = "y7_2019/";
  const questions = [
      { text: `Q1.<img src="${IMG_FOLDER}q1.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "D" },
      { text: `Q2.<img src="${IMG_FOLDER}q2.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "B" },
      { text: `Q3.<img src="${IMG_FOLDER}q3.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "C" },
      { text: `Q4.<img src="${IMG_FOLDER}q4.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "B" },
      { text: `Q5.<img src="${IMG_FOLDER}q5.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "A" },
      { text: `Q6.<img src="${IMG_FOLDER}q6.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "B" },
      { text: `Q7.<img src="${IMG_FOLDER}q7.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "C" },
      { text: `Q8.<img src="${IMG_FOLDER}q8.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "D" },
      { text: `Q9.<img src="${IMG_FOLDER}q9.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "C" },
      { text: `Q10.<img src="${IMG_FOLDER}q10.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "C" },
      { text: `Q11.<img src="${IMG_FOLDER}q11.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "B" },
      { text: `Q12.<img src="${IMG_FOLDER}q12.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "D" },
      { text: `Q13.<img src="${IMG_FOLDER}q13.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "A" },
      { text: `Q14.<img src="${IMG_FOLDER}q14.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "B" },
      { text: `Q15.<img src="${IMG_FOLDER}q15.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "A,D" },
      { text: `Q16.<img src="${IMG_FOLDER}q16.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "C" },
      { text: `Q17.<img src="${IMG_FOLDER}q17.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "B" },
      { text: `Q18.<img src="${IMG_FOLDER}q18.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "D" },
      { text: `Q19.<img src="${IMG_FOLDER}q19.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "B" },
      { text: `Q20.<img src="${IMG_FOLDER}q20.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "A" },
      { text: `Q21.<img src="${IMG_FOLDER}q21.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "D" },
      { text: `Q22.<img src="${IMG_FOLDER}q22.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "A" },
      { text: `Q23.<img src="${IMG_FOLDER}q23.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "C" },
      { text: `Q24.<img src="${IMG_FOLDER}q24.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "D" },
      { text: `Q25.<img src="${IMG_FOLDER}q25.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "B" },
      { text: `Q26.<img src="${IMG_FOLDER}q26.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "B" },
      { text: `Q27.<img src="${IMG_FOLDER}q27.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "A" },
      { text: `Q28.<img src="${IMG_FOLDER}q28.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "B" },
      { text: `Q29.<img src="${IMG_FOLDER}q29.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "A" },
      { text: `Q30.<img src="${IMG_FOLDER}q30.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "A" },
      { text: `Q31.<img src="${IMG_FOLDER}q31.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "D" },
      { text: `Q32.<img src="${IMG_FOLDER}q32.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "B" },
      { text: `Q33.<img src="${IMG_FOLDER}q33.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "B,D" },
      { text: `Q34.<img src="${IMG_FOLDER}q34.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "D" },
      { text: `Q35.<img src="${IMG_FOLDER}q35.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"", B:"", C:"", D:"" }, answer: "C" },
      { text: `Q36.<img src="${IMG_FOLDER}q36.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"26", B:"30", C:"35", D:"40" }, answer: "C" },
      { text: `Q37.<img src="${IMG_FOLDER}q37.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"121", B:"124", C:"127", D:"112" }, answer: "D" },
      { text: `Q38.<img src="${IMG_FOLDER}q38.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"70", B:"62", C:"59", D:"48" }, answer: "C" },
      { text: `Q39.<img src="${IMG_FOLDER}q39.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"30", B:"40", C:"50", D:"60" }, answer: "C" },
      { text: `Q40.<img src="${IMG_FOLDER}q40.png" alt="" style="max-width:100%; margin-top:8px;">`, options: { A:"90", B:"110", C:"130", D:"148" }, answer: "A" }
  ];

  let currentQuestionIndex = 0;
  let score = 0;
  let selectedAnswer = null;
  let userAnswers = Array(questions.length).fill(null);
  let studentName = "Anonymous";

  const quizContent = document.getElementById('quizContent');
  const nextButton = document.getElementById('nextButton');
  const backButton = document.getElementById('backButton');
  const questionNav = document.getElementById('questionNav');

  function renderQuestionNav() {
      if (!questionNav) return;
      let html = '<table><tbody>';
      questions.forEach((q, index) => {
          const isCurrent = index === currentQuestionIndex;
          html += `
              <tr>
                  <td data-qindex="${index}" class="${isCurrent ? 'current-question' : ''}">
                      Q${index + 1}
                  </td>
              </tr>
          `;
      });
      html += '</tbody></table>';
      questionNav.innerHTML = html;
  }

  function goToQuestion(index) {
      if (index < 0 || index >= questions.length) return;
      currentQuestionIndex = index;
      renderQuestion();
  }

  if (questionNav) {
      questionNav.addEventListener('click', function (event) {
          const cell = event.target.closest('td[data-qindex]');
          if (!cell) return;
          const idx = parseInt(cell.getAttribute('data-qindex'), 10);
          if (Number.isNaN(idx)) return;
          goToQuestion(idx);
      });
  }

  quizContent.addEventListener('click', function(event) {
      let clickedElement = event.target;
      while (clickedElement && clickedElement.tagName !== 'LI') {
          if (clickedElement === quizContent) return;
          clickedElement = clickedElement.parentElement;
      }
      if (clickedElement && clickedElement.hasAttribute('data-answer')) {
          const key = clickedElement.getAttribute('data-answer');
          handleAnswerSelect(clickedElement, key);
      }
  });

  function renderQuestion() {
      if (currentQuestionIndex >= questions.length) {
          if (currentQuestionIndex === questions.length) {
              calculateFinalScore();
              showFinalResult();
          }
          return;
      }

      const q = questions[currentQuestionIndex];
      quizContent.innerHTML = '';

      renderQuestionNav();

      selectedAnswer = userAnswers[currentQuestionIndex]
          ? userAnswers[currentQuestionIndex].userChoice
          : null;

      nextButton.textContent =
          (currentQuestionIndex === questions.length - 1) ? 'View Results' : 'Next Question';

      nextButton.style.display = 'inline-block';
      backButton.style.display = 'inline-block';
      backButton.style.visibility = (currentQuestionIndex > 0) ? 'visible' : 'hidden';

      const qText = document.createElement('p');
      qText.className = 'question-text';
      qText.innerHTML = `(Question ${currentQuestionIndex + 1} of ${questions.length}) ` + q.text;
      quizContent.appendChild(qText);

      const optionsList = document.createElement('ul');
      optionsList.className = 'options-list';

      for (const key in q.options) {
          const listItem = document.createElement('li');
          listItem.textContent = `${key}. ${q.options[key]}`;
          listItem.setAttribute('data-answer', key);

          if (key === selectedAnswer) listItem.classList.add('selected');
          optionsList.appendChild(listItem);
      }
      quizContent.appendChild(optionsList);
  }

  function handleAnswerSelect(selectedElement, key) {
      selectedAnswer = key;
      const options = selectedElement.parentElement.querySelectorAll('li');
      options.forEach(option => option.classList.remove('selected'));
      selectedElement.classList.add('selected');
  }

  function saveAnswerAndMove(direction) {
      const q = questions[currentQuestionIndex];
      const isCorrect = (selectedAnswer !== null) && (selectedAnswer === q.answer);

      userAnswers[currentQuestionIndex] = {
          questionIndex: currentQuestionIndex,
          userChoice: selectedAnswer,
          correctAnswer: q.answer,
          isCorrect: isCorrect
      };

      if (direction === 'next') currentQuestionIndex++;
      else if (direction === 'back' && currentQuestionIndex > 0) currentQuestionIndex--;

      renderQuestion();
  }

  nextButton.addEventListener('click', function() { saveAnswerAndMove('next'); });
  backButton.addEventListener('click', function() { saveAnswerAndMove('back'); });

  function calculateFinalScore() {
      score = 0;
      userAnswers.forEach(answer => { if (answer && answer.isCorrect) score++; });
  }

  function saveResultsToFile() {
      const now = new Date();
      const timestampForFile = now.toISOString().replace(/[:.]/g, '-');
      const safeName = studentName.replace(/\s+/g, '_') || 'Student';
      const filename = `ICAS_Y7_2019_Result_${safeName}_${timestampForFile}.txt`;

      let content = '';
      content += 'ICAS Year 7 – 2019 Result\n';
      content += '--------------------------------------\n\n';
      content += `Student: ${studentName}\n`;
      content += `Date: ${now.toLocaleString()}\n`;
      content += `Score: ${score} / ${questions.length}\n\n`;
      content += 'Detailed Breakdown:\n\n';

      questions.forEach((q, index) => {
          const result = userAnswers[index] || {
              userChoice: null,
              correctAnswer: q.answer,
              isCorrect: false
          };
          const userChoiceKey = result.userChoice ? result.userChoice : null;
          const userChoiceText = userChoiceKey
              ? `${userChoiceKey}. ${q.options[userChoiceKey]}`
              : 'Skipped';

          const correctAnswerText = `${q.answer}. ${q.options[q.answer]}`;
          const resultText = result.isCorrect ? 'Correct' : 'Incorrect';

          content += `Q${index + 1}: ${q.text}\n`;
          content += `Your answer: ${userChoiceText}\n`;
          content += `Correct answer: ${correctAnswerText}\n`;
          content += `Result: ${resultText}\n\n`;
      });

      const blob = new Blob([content], { type: 'text/plain' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(link.href);
  }

  function showFinalResult() {
      renderQuestionNav();

      let reviewHTML = `
          <div id="studentInfo">
              <strong>Student Name:</strong> ${studentName}
          </div>
          <div id="finalResult">
              <p>You have finished all ${questions.length} questions.</p>
              <p>Your final score is: <strong>${score} / ${questions.length}</strong></p>
          </div>
          <h3>Detailed Review</h3>
          <table class="review-table">
              <thead>
                  <tr>
                      <th>#</th>
                      <th>Your Answer</th>
                      <th>Correct Answer</th>
                      <th>Result</th>
                  </tr>
              </thead>
              <tbody>
      `;

      questions.forEach((q, index) => {
          const result = userAnswers[index] || {
              userChoice: null,
              correctAnswer: q.answer,
              isCorrect: false
          };
          const userChoiceKey = result.userChoice ? result.userChoice : null;
          const userChoiceText = userChoiceKey
              ? `${userChoiceKey}. ${q.options[userChoiceKey]}`
              : '— Skipped —';

          const resultClass = result.isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultText = result.isCorrect ? 'Correct' : 'Incorrect';
          const correctAnswerText = `${q.answer}. ${q.options[q.answer]}`;

          reviewHTML += `
              <tr>
                  <td>Q${index + 1}</td>
                  <td>${userChoiceText}</td>
                  <td class="${result.isCorrect ? '' : 'correct-answer'}">${correctAnswerText}</td>
                  <td class="${resultClass}">${resultText}</td>
              </tr>
          `;
      });

      reviewHTML += `
              </tbody>
          </table>
          <button id="saveResultsButton">Save Results</button>
      `;

      quizContent.innerHTML = reviewHTML;
      nextButton.style.display = 'none';
      backButton.style.display = 'none';

      const saveBtn = document.getElementById('saveResultsButton');
      if (saveBtn) saveBtn.addEventListener('click', saveResultsToFile);
  }

  function showStartScreen() {
      nextButton.style.display = 'none';
      backButton.style.display = 'none';
      if (questionNav) questionNav.innerHTML = '';

      // 如果 URL 里带了 name，就自动开始（不显示输入框）
      if (urlStudentName) {
          studentName = urlStudentName;
          startQuizAuto();
          return;
      }

      // 没带 name，才显示输入框（兼容手动输入）
      quizContent.innerHTML = `
          <div id="startScreen">
              <p class="question-text">
                  Welcome to the ICAS Year 7 – 2019 practice! This test has ${questions.length} questions.
                  Please enter your name to begin.
              </p>
              <label for="nameInput">Name:</label>
              <input type="text" id="nameInput" placeholder="Enter your name here" required>
              <button id="startButton">Start Quiz</button>
          </div>
      `;

      document.getElementById('startButton').addEventListener('click', startQuizManual);
  }

  function initAnswersArray() {
      userAnswers = Array(questions.length).fill(null).map((_, index) => ({
          questionIndex: index,
          userChoice: null,
          correctAnswer: questions[index].answer,
          isCorrect: false
      }));
  }

  function startQuizAuto() {
      initAnswersArray();
      currentQuestionIndex = 0;
      renderQuestion();
  }

  function startQuizManual() {
      const nameInput = document.getElementById('nameInput').value.trim();
      studentName = nameInput ? nameInput : "Anonymous Student";
      startQuizAuto();
  }

  showStartScreen();
</script>

</body>
</html>
